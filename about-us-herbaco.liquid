{%- style -%}
  {{ section.settings.heading_font | font_face: font_display: 'swap' }}
  {{ section.settings.body_font | font_face: font_display: 'swap' }}
{%- endstyle -%}

<div class="human-element-wrapper" data-section-id="{{ section.id }}">
  
  <div class="human-element-container">
    <div class="human-grid {% if section.settings.layout_flip %}human-grid--flipped{% endif %}">
      
      <div class="human-content">
        <div class="human-content-inner">
          
          {%- if section.settings.eyebrow != blank -%}
            <div class="human-eyebrow animate-on-scroll">
              {{ section.settings.eyebrow }}
              <span class="eyebrow-line"></span>
            </div>
          {%- endif -%}

          {%- if section.settings.title != blank -%}
            <h2 class="human-title animate-on-scroll" style="--delay: 0.1s;">
              {{ section.settings.title | newline_to_br }}
            </h2>
          {%- endif -%}

          <div class="human-body animate-on-scroll" style="--delay: 0.2s;">
            {{ section.settings.body }}
          </div>

          {%- if section.settings.quote != blank -%}
            <div class="human-quote animate-on-scroll" style="--delay: 0.3s;">
              <blockquote>
                "{{ section.settings.quote }}"
              </blockquote>
              {%- if section.settings.quote_author != blank -%}
                <cite>â€” {{ section.settings.quote_author }}</cite>
              {%- endif -%}
            </div>
          {%- endif -%}

          {%- if section.settings.show_signature and section.settings.signature_image != blank -%}
            <div class="human-signature animate-on-scroll" style="--delay: 0.4s;">
              {{ section.settings.signature_image | image_url: width: 300 | image_tag: loading: 'lazy', alt: section.settings.quote_author }}
            </div>
          {%- endif -%}

          {%- if section.settings.cta_text != blank -%}
            <div class="human-cta-wrapper animate-on-scroll" style="--delay: 0.5s;">
              <a href="{{ section.settings.cta_url }}" class="human-btn">
                {{ section.settings.cta_text }}
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 11L11 1M11 1H3M11 1V9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </a>
            </div>
          {%- endif -%}
        </div>
      </div>

      <div class="human-visual animate-on-scroll">
        <div class="human-card">
          {%- if section.settings.main_image != blank -%}
            {{ section.settings.main_image | image_url: width: 1200 | image_tag: loading: 'lazy', class: 'human-img', sizes: '(min-width: 768px) 50vw, 100vw' }}
          {%- else -%}
            {{ 'lifestyle-1' | placeholder_svg_tag: 'human-img placeholder-svg' }}
          {%- endif -%}

          {%- if section.settings.show_badge -%}
            <div class="human-badge">
              <span class="badge-text">{{ section.settings.badge_text }}</span>
              <span class="badge-icon">{{ section.settings.badge_subtext | newline_to_br }}</span>
            </div>
          {%- endif -%}
          
          <div class="human-glint"></div>
        </div>
      </div>

    </div>
    
    <button type="button" 
            class="easter-egg-btn" 
            aria-label="Secret">
      <img src="https://cdn.shopify.com/s/files/1/0697/1880/2532/files/egg-crack.svg?v=1770423160" width="40" height="40" alt="Crack" loading="lazy">
    </button>
  </div>

  <style>
    /* VARIABLES */
    .human-element-wrapper[data-section-id="{{ section.id }}"] {
      --font-heading: {{ section.settings.heading_font.family }}, {{ section.settings.heading_font.fallback_families }};
      --font-heading-weight: {{ section.settings.heading_font.weight }};
      --font-body: {{ section.settings.body_font.family }}, {{ section.settings.body_font.fallback_families }};
      
      {% if section.settings.transparent_bg %}
        --bg-color: transparent;
      {% else %}
        --bg-color: {{ section.settings.bg_color }};
      {% endif %}
      
      --text-color: {{ section.settings.text_color }};
      --accent-color: {{ section.settings.accent_color }};
      --card-bg: {{ section.settings.card_bg | color_modify: 'alpha', section.settings.card_opacity }};
      
      --spacing-top: {{ section.settings.padding_top }}px;
      --spacing-bottom: {{ section.settings.padding_bottom }}px;
      --spacing-top-mob: {{ section.settings.padding_top | divided_by: 2 }}px;
      --spacing-bottom-mob: {{ section.settings.padding_bottom | divided_by: 2 }}px;
      
      --badge-scale: {{ section.settings.badge_scale | divided_by: 100.0 }};
      
      /* EASTER EGG VARIABLES */
      --egg-pos-x: {{ section.settings.egg_x }}%;
      --egg-pos-y: {{ section.settings.egg_y }}px;
      --egg-opacity: {{ section.settings.egg_opacity | divided_by: 100.0 }};
      
      background-color: var(--bg-color);
      color: var(--text-color);
      padding-top: var(--spacing-top);
      padding-bottom: var(--spacing-bottom);
      overflow: hidden;
      position: relative;
      
      /* FORCE FULL WIDTH BREAKOUT */
      width: 100vw;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      left: 50%;
      right: 50%;
      transform: translateX(-50%);
    }

    @media screen and (max-width: 768px) {
      .human-element-wrapper[data-section-id="{{ section.id }}"] {
        padding-top: var(--spacing-top-mob);
        padding-bottom: var(--spacing-bottom-mob);
      }
    }

    /* CONTAINER */
    .human-element-container {
      max-width: {{ section.settings.container_width }}px;
      margin: 0 auto;
      padding: 0 2rem;
      position: relative;
      height: 100%;
    }

    .human-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      /* This ensures both columns are exactly the same height */
      align-items: stretch; 
    }

    .human-grid--flipped {
      direction: rtl;
    }
    .human-grid--flipped > * {
      direction: ltr;
    }

    @media screen and (max-width: 900px) {
      .human-grid {
        grid-template-columns: 1fr;
        gap: 3rem;
        display: flex;
        flex-direction: column-reverse;
      }
      .human-grid--flipped {
        flex-direction: column-reverse;
      }
    }

    /* CONTENT TYPOGRAPHY */
    .human-content {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .human-content-inner {
      width: 100%;
      max-width: 520px;
      margin: 0 auto 0 0; 
      transform-style: preserve-3d; 
    }
    
    .human-grid--flipped .human-content-inner {
      margin: 0 0 0 auto;
    }

    .human-eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      font-family: var(--font-body);
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.15em;
      font-weight: 600;
      color: var(--accent-color);
      margin-top: 0;
      margin-bottom: 1rem;
      line-height: 1; 
    }
    
    .eyebrow-line {
      height: 1px;
      width: 40px;
      background-color: var(--accent-color);
      display: block;
    }

    .human-title {
      font-family: var(--font-heading);
      font-weight: var(--font-heading-weight);
      font-size: {{ section.settings.heading_size }}px;
      line-height: 1.1;
      margin-bottom: 1.5rem;
      letter-spacing: -0.02em;
    }

    .human-body {
      font-family: var(--font-body);
      font-size: 1rem;
      line-height: 1.6;
      color: {{ section.settings.text_color | color_modify: 'alpha', 0.8 }};
      margin-bottom: 2rem;
    }

    .human-body p { margin-bottom: 1rem; }

    /* QUOTE & SIGNATURE */
    .human-quote {
      border-left: 2px solid var(--accent-color);
      padding-left: 1.5rem;
      margin: 2rem 0;
    }
    
    .human-quote blockquote {
      font-family: var(--font-heading);
      font-style: italic;
      font-size: 1.25rem;
      margin: 0 0 0.5rem 0;
      color: var(--text-color);
    }

    .human-quote cite {
      font-family: var(--font-body);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-style: normal;
      opacity: 0.7;
    }

    .human-signature img {
      height: {{ section.settings.sig_size }}px;
      width: auto;
      object-fit: contain;
      margin-bottom: 1.5rem;
      background: transparent;
    }

    /* BUTTON */
    .human-cta-wrapper {
        margin-bottom: 0;
        line-height: 0;
    }

    .human-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      background: transparent;
      border: 1px solid var(--text-color);
      color: var(--text-color);
      text-decoration: none;
      font-family: var(--font-body);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .human-btn::after {
      content: '';
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--text-color);
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: -1;
    }

    .human-btn:hover {
      color: var(--bg-color);
      {% if section.settings.transparent_bg %}
         color: #fff;
      {% endif %}
      border-color: var(--text-color);
    }
    
    .human-btn:hover::after {
      transform: translateY(0);
    }

    /* IMAGE CARD - THE CLAMP */
    .human-visual {
        display: flex;
        flex-direction: column;
    }

    .human-card {
      position: relative;
      width: 100%;
      height: 100%; 
      aspect-ratio: auto; 
      background: var(--card-bg);
      border-radius: {{ section.settings.border_radius }}px;
      overflow: hidden;
      box-shadow: 0 20px 40px -10px rgba(0,0,0,0.05);
      transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), box-shadow 0.6s ease;
    }

    .human-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 30px 60px -15px rgba(0,0,0,0.1);
    }

    .human-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 1.2s cubic-bezier(0.16, 1, 0.3, 1);
      filter: contrast(0.95) saturate(0.9);
    }
    
    img.human-img { background: transparent; }

    .human-card:hover .human-img {
      transform: scale(1.05);
      filter: contrast(1) saturate(1);
    }

    /* BADGE */
    .human-badge {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(8px);
      padding: 12px 16px;
      border: 1px solid rgba(0,0,0,0.05);
      border-radius: 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      z-index: 2;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      transform-origin: bottom right;
      transform: scale(var(--badge-scale));
    }

    .badge-text {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      opacity: 0.6;
      color: #000;
    }

    .badge-icon {
      font-family: var(--font-heading);
      font-size: 0.9rem;
      line-height: 1.1;
      color: #000;
    }

    /* GLINT EFFECT */
    .human-glint {
      position: absolute;
      top: 0; left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(to right, transparent, rgba(255,255,255,0.2), transparent);
      transform: skewX(-25deg);
      pointer-events: none;
      transition: left 0.5s;
    }

    .human-card:hover .human-glint {
      left: 200%;
      transition: left 0.8s ease-in-out;
    }
    
    /* EASTER EGG STYLES */
    .easter-egg-btn {
      position: absolute;
      bottom: var(--egg-pos-y);
      left: var(--egg-pos-x);
      background: none;
      border: none;
      opacity: var(--egg-opacity);
      cursor: pointer;
      color: var(--text-color);
      transition: opacity 0.3s ease, transform 0.5s ease;
      z-index: 99; /* Boosted z-index */
      padding: 0;
    }
    .easter-egg-btn img {
      display: block;
    }

    .easter-egg-btn:hover {
      opacity: 1; /* Always go to full opacity on hover */
      transform: rotate(15deg) scale(1.1);
    }

    /* GRAVITY BREAK ANIMATION */
    .gravity-broken .human-eyebrow,
    .gravity-broken .human-title,
    .gravity-broken .human-body,
    .gravity-broken .human-quote,
    .gravity-broken .human-signature,
    .gravity-broken .human-cta-wrapper {
      transition: transform 0.8s cubic-bezier(0.6, 0.04, 0.98, 0.335), opacity 0.5s ease;
      transform-origin: bottom center;
    }

    /* Individual scatter transforms */
    .gravity-broken .human-eyebrow { transform: translateY(500px) rotate(-15deg); }
    .gravity-broken .human-title { transform: translateY(480px) rotate(5deg); }
    .gravity-broken .human-body { transform: translateY(450px) rotate(-5deg); }
    .gravity-broken .human-quote { transform: translateY(420px) rotate(8deg); }
    .gravity-broken .human-signature { transform: translateY(390px) rotate(-10deg); }
    .gravity-broken .human-cta-wrapper { transform: translateY(360px) rotate(12deg); }

    /* ANIMATION UTILS */
    .animate-on-scroll {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
      transition-delay: var(--delay, 0s);
    }

    .animate-on-scroll.is-visible {
      opacity: 1;
      transform: translateY(0);
    }

    @media screen and (max-width: 768px) {
      .human-title { font-size: {{ section.settings.heading_size | times: 0.7 }}px; }
      .human-card { aspect-ratio: 1/1; height: auto; } /* Reset height on mobile */
      .human-grid { align-items: flex-start; }
      .easter-egg-btn { display: none; }
    }
  </style>

  <script>
    (function() {
      // Main init function that handles both initial load and re-renders
      function initHumanSection(container) {
        // Ensure we are scoping to this specific section to avoid conflicts
        const sectionId = "{{ section.id }}";
        const wrapper = container.querySelector(`.human-element-wrapper[data-section-id="${sectionId}"]`);
        
        if (!wrapper) return;

        // 1. Scroll Reveal Observer
        const observer = new IntersectionObserver((entries, obs) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              obs.unobserve(entry.target);
            }
          });
        }, { threshold: 0.1 });

        // Force observer to check immediately if inside design mode (editor)
        const isDesignMode = Shopify.designMode;
        
        wrapper.querySelectorAll('.animate-on-scroll').forEach(el => {
          if(isDesignMode) {
             el.classList.add('is-visible');
          } else {
             observer.observe(el);
          }
        });

        // 2. Easter Egg Logic (Fixed)
        const eggBtn = wrapper.querySelector('.easter-egg-btn');
        if (eggBtn) {
          eggBtn.addEventListener('click', function(e) {
            e.preventDefault();
            wrapper.classList.toggle('gravity-broken');
          });
        }
      }

      // Initialize on load
      document.addEventListener("DOMContentLoaded", function() {
        initHumanSection(document);
      });

      // Initialize on Shopify Theme Editor events to fix "blank" screen on edit
      document.addEventListener("shopify:section:load", function(event) {
        if (event.detail.sectionId === "{{ section.id }}") {
          initHumanSection(event.target);
        }
      });
    })();
  </script>
</div>

{% schema %}
{
  "name": "Human Element (About Us)",
  "settings": [
    {
      "type": "header",
      "content": "Fonts & Typography"
    },
    {
      "type": "font_picker",
      "id": "heading_font",
      "label": "Heading Font",
      "default": "serif"
    },
    {
      "type": "font_picker",
      "id": "body_font",
      "label": "Body Font",
      "default": "sans-serif"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "container_width",
      "min": 800,
      "max": 1600,
      "step": 20,
      "unit": "px",
      "label": "Container Max Width",
      "default": 1200
    },
    {
      "type": "checkbox",
      "id": "layout_flip",
      "label": "Flip Layout (Image Left)",
      "default": false
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 160,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 100
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 160,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 100
    },
    {
      "type": "header",
      "content": "Text Content"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow Text",
      "default": "Our Philosophy"
    },
    {
      "type": "textarea",
      "id": "title",
      "label": "Heading",
      "default": "From the earth,\nfor the ritual."
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 24,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Heading Font Size",
      "default": 48
    },
    {
      "type": "richtext",
      "id": "body",
      "label": "Body Text",
      "default": "<p>We didn't start this to compromise. Every leaf, every blend is sourced from growers we know by name.</p>"
    },
    {
      "type": "header",
      "content": "Quote & Signature"
    },
    {
      "type": "textarea",
      "id": "quote",
      "label": "Pull Quote",
      "default": "Real herbs means respecting the process."
    },
    {
      "type": "text",
      "id": "quote_author",
      "label": "Author Name",
      "default": "Founders"
    },
    {
      "type": "checkbox",
      "id": "show_signature",
      "label": "Show Signature Image",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "signature_image",
      "label": "Signature Image (Transparent PNG)"
    },
    {
      "type": "range",
      "id": "sig_size",
      "min": 20,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Signature Height",
      "default": 40
    },
    {
      "type": "header",
      "content": "Main Visual"
    },
    {
      "type": "image_picker",
      "id": "main_image",
      "label": "Main Image"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Corner Radius",
      "default": 8
    },
    {
      "type": "header",
      "content": "Floating Badge"
    },
    {
      "type": "checkbox",
      "id": "show_badge",
      "label": "Show Badge",
      "default": true
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Badge Top Text",
      "default": "EST. 2024"
    },
    {
      "type": "textarea",
      "id": "badge_subtext",
      "label": "Badge Main Text",
      "default": "Using nature's\nblueprint."
    },
    {
      "type": "range",
      "id": "badge_scale",
      "min": 50,
      "max": 150,
      "step": 5,
      "unit": "px",
      "label": "Badge Scale",
      "default": 100
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "checkbox",
      "id": "transparent_bg",
      "label": "Transparent Background",
      "info": "Overrides the background color setting",
      "default": false
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Section Background",
      "default": "#f4f4f4"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#5c6b5e"
    },
    {
      "type": "color",
      "id": "card_bg",
      "label": "Card Background Color",
      "default": "#e0e0e0"
    },
    {
      "type": "range",
      "id": "card_opacity",
      "min": 0,
      "max": 1,
      "step": 0.1,
      "label": "Card Background Opacity",
      "info": "Set to 0 if image is transparent PNG",
      "default": 1.0
    },
    {
      "type": "header",
      "content": "Call to Action"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "Button Label",
      "default": "Read Our Story"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "Button Link"
    },
    {
      "type": "header",
      "content": "Easter Egg Settings"
    },
    {
      "type": "range",
      "id": "egg_x",
      "label": "Horizontal Position",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 5,
      "info": "0% is Left, 100% is Right"
    },
    {
      "type": "range",
      "id": "egg_y",
      "label": "Vertical Position",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "default": 10,
      "info": "Distance from bottom"
    },
    {
      "type": "range",
      "id": "egg_opacity",
      "label": "Button Opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 10
    }
  ],
  "presets": [
    {
      "name": "Human Element (Custom)",
      "settings": {
        "title": "From the earth,\nfor the ritual.",
        "eyebrow": "Our Philosophy"
      }
    }
  ]
}
{% endschema %}
